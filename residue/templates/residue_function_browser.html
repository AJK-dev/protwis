{% extends "home/base.html" %}
{% load staticfiles %}

{% block addon_css %}
<link rel="stylesheet" href="{% static 'home/css/jquery.dataTables.min.css' %}" type="text/css" />
<!-- <link rel="stylesheet" href="{% static 'home/css/jquery.fixedHeader.dataTables.min.css' %}" type="text/css" />-->
<link rel="stylesheet" href="{% static 'home/css/yadcf_bootstrap_version.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'home/css/select2.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'home/css/residue_function_browser.css' %}" type="text/css" />

{% endblock %}

{% block addon_js %}
<script src="{% static 'home/js/jquery.dataTables.min.js' %}"> </script>
<script src="{% static 'home/js/jquery.dataTables.yadcf.js' %}"> </script>
<script src="{% static 'home/js/select2.js' %}"> </script>

<!--
<script src="{% static 'home/js/dataTables.tableTools.min.js' %}"> </script>
<script src="{% static 'home/js/jquery.dataTables.columnFilter.js' %}"> </script>
<script src="{% static 'home/js/jquery.dataTables.fixedColumns.js' %}"> </script>
<script src="{% static 'home/js/selection.js' %}"> </script>
-->

<script src="{% static 'home/js/table2csv.js' %}"> </script>


<script type="text/javascript" charset="utf-8">
  // make table interactive
  $(document).ready( function () {
    var oTable = $('#residue_function_browser').DataTable({
      scrollY:        "80vh",
      scrollX:        true,
      scrollCollapse: true,
      paging:         false,
      "order": [],
        columnDefs: [
          { targets: 'no-sort', orderable: false }

        ],
        fixedColumns:   {
           leftColumns: 1,
        }
    });

    var prev_ids = Array()
    var current_align_ids = Array()

    console.log(oTable);
/*    $("#rfb_div").show();
    assign_to_row();
    $("#loading_div").hide();*/

    yadcf.init(oTable,
        [
            {
                column_number : 0,
                filter_type: "multi_select",
                select_type: 'select2',
                column_data_type: "rendered_html",
                html_data_type: "text",
                filter_default_label: "Position",
                filter_match_mode : "exact",
                filter_reset_button_text: false,
                select_type_options: {
                    width: '60px',
                }
            },
            {
                column_number : 1,
                filter_type: "multi_select",
                select_type: 'select2',
                column_data_type: "html",
                html_data_type: "text",
                filter_default_label: "Consensus AA",
                filter_match_mode : "exact",
                filter_reset_button_text: false,
                select_type_options: {
                    width: '90px',
                }
            },
            {
                column_number : 2,
                filter_type: "range_number_slider",
                filter_delay: 150,
                select_type_options: {
                    width: '80px',
                }
            },
            {
                column_number : 3,
                filter_type: "multi_select",
                select_type: 'select2',
                column_data_type: "html",
                html_data_type: "text",
                filter_default_label: "Consensus Property",
                filter_match_mode : "exact",
                filter_reset_button_text: false,
                select_type_options: {
                    width: '80px',
                }
            },
            {
                column_number : 4,
                filter_type: "range_number_slider",
                filter_delay: 150,
                select_type_options: {
                    width: '80px',
                }
            },
            {
                column_number : 5,
                filter_type: "multi_select",
                select_type: 'select2',
                column_data_type: "html",
                html_data_type: "text",
                filter_default_label: "Segment",
                filter_match_mode : "exact",
                filter_reset_button_text: false,
                select_type_options: {
                    width: '60px',
                }
            },
            {
                column_number : 6,
                filter_type: "multi_select",
                select_type: 'select2',
                column_data_type: "html",
                html_data_type: "text",
                filter_default_label: "Placement",
                filter_match_mode : "exact",
                filter_reset_button_text: false,
                select_type_options: {
                    width: '60px',
                }
            },
            {
                column_number : 7,
                filter_type: "range_number_slider",
                filter_delay: 150,
                select_type_options: {
                    width: '80px',
                }
            },
            {
                column_number : 8,
                filter_type: "multi_select",
                select_type: 'select2',
                column_data_type: "html",
                html_data_type: "text",
                filter_default_label: "Inward/Outward TM bundle",
                filter_match_mode : "exact",
                filter_reset_button_text: false,
                select_type_options: {
                    width: '60px',
                }
            },
            {
                column_number : 9,
                filter_type: "multi_select",
                select_type: 'select2',
                column_data_type: "html",
                html_data_type: "text",
                filter_default_label: "Microswitch",
                filter_match_mode : "exact",
                filter_reset_button_text: false,
                select_type_options: {
                    width: '60px',
                }
            },
            {
                column_number : 10,
                filter_type: "multi_select",
                select_type: 'select2',
                column_data_type: "html",
                html_data_type: "text",
                filter_default_label: "Sodium pocket",
                filter_match_mode : "exact",
                filter_reset_button_text: false,
                select_type_options: {
                    width: '60px',
                }
            },
            {
                column_number : 11,
                filter_type: "multi_select",
                select_type: 'select2',
                column_data_type: "html",
                html_data_type: "text",
                filter_default_label: "Rotamer switch",
                filter_match_mode : "exact",
                filter_reset_button_text: false,
                select_type_options: {
                    width: '60px',
                }
            },
            {
                column_number : 12,
                filter_type: "range_number_slider",
                filter_delay: 150,
                select_type_options: {
                    width: '80px',
                }
            },
        ],
        {
            cumulative_filtering: false
        }
    );

    yadcf.exResetAllFilters(oTable);
  });

  // enable CSV download
  function download(){
    $('#residue_function_browser').table2csv({filename: 'GPCRdb_residue_function.csv', quoteFields: true});
  }

/*  function assign_to_row(){
    $('tbody tr').click(function(event) {
      if (event.target.type !== 'checkbox') {
        $(':checkbox', this).trigger('click');
      }
    });
  }*/
</script>
{% endblock %}

{% block content %}
<!--<div style="padding-top: 0px; font-size: 15px; white-space: nowrap;" id="loading_div">
  <br>Loading...
</div>-->
<div style="padding-top: 0px; font-size: 10px; white-space: nowrap;" id="rfb_div">
    <a id="download_btn" class="btn btn-primary btn-mini " href="javascript:download()"><span class="glyphicon glyphicon-download"></span> CSV Download</a>
    <table width="100%" class="display compact" id="residue_function_browser">
        <thead>
            <tr class='over_header' style='max-height: 20px'>
                <th colspan=1 class='no-sort'></th>
                <th colspan=4 class="over_header">DATA CATEGORY</th>
                <th colspan=4 class="over_header">DATA CATEGORY</th>
                <th colspan=4 class="over_header">DATA CATEGORY</th>
                <th colspan=4 class="over_header">DATA CATEGORY</th>
                <th colspan=4 class="over_header">DATA CATEGORY</th>
                <th colspan=4 class="over_header">DATA CATEGORY</th>
                <th colspan=4 class="over_header">DATA CATEGORY</th>
                <th colspan=4 class="over_header">DATA CATEGORY</th>
                <th colspan=4 class="over_header">DATA CATEGORY</th>
                <th colspan=4 class="over_header">DATA CATEGORY</th>
                <th colspan=3 class="over_header">DATA CATEGORY</th>
            </tr>
            <tr>
                <th class="general-th"></th>
                <!-- Class A data -->
                <th class="general-th"></th>
                <th class="general-th">Conservation (%)</th>
                <th class="general-th"></th>
                <th class="general-th">Conservation (%)</th>

                <!-- Positional data -->
                <th class="positional-th"></th>
                <th class="positional-th"></th>
                <th class="positional-th">#AA Above<br/>membrane center</th>
                <th class="positional-th">TM bundle</th>
                <th class="positional-th"></th>
                <th class="positional-th"></th>
                <th class="positional-th"></th>

                <!-- Mutation data -->
                <th class="mutational-th">Natural<br/>mutations</th>
                <th class="mutational-th">≥30% change<br/>basal act. mut.</th>
                <th class="mutational-th">≥5-fold<br/>ligand mut.</th>
                <th class="mutational-th">Phosphorylation</th>
                <th class="mutational-th">Palmitoylation</th>
                <th class="mutational-th">Glycosylation</th>
                <th class="mutational-th">Ubiquitylation</th>
                <th class="mutational-th">Thermostabilizing<br/>mutants</th>

                <!-- X-ray data -->
                <th class="structural-th">Ligand<br/>contacts</th>
                <th class="structural-th">Unique active<br/>contacts</th>
                <th class="structural-th">Unique inactive<br/>contacts</th>
                <th class="structural-th">Intra-segment<br/>contacts</th>
                <th class="structural-th">G-protein<br/>interface</th>
                <th class="structural-th">Arrestin<br/>interface</th>

                <!-- Signatures data-->
                <th class="signatures-th">High CA<br/>SignScore (%)</th>
                <th class="signatures-th">High CA<br/>SignProp</th>
                <th class="signatures-th">High CA<br/>Symbol</th>
                <th class="signatures-th">Low CA<br/>SignScore (%)</th>
                <th class="signatures-th">Low CA<br/>SignProp</th>
                <th class="signatures-th">Low CA<br/>Symbol</th>
                <th class="signatures-th">Gs<br/>SignScore (%)</th>
                <th class="signatures-th">Gs<br/>SignProp</th>
                <th class="signatures-th">Gs<br/>Symbol</th>
                <th class="signatures-th">Gi/o<br/>SignScore (%)</th>
                <th class="signatures-th">Gi/o<br/>SignProp</th>
                <th class="signatures-th">Gi/o<br/>Symbol</th>
                <th class="signatures-th">Gq/11<br/>SignScore (%)</th>
                <th class="signatures-th">Gq/11<br/>SignProp</th>
                <th class="signatures-th">Gq/11<br/>Symbol</th>
                <th class="signatures-th">G12/13<br/>SignScore (%)</th>
                <th class="signatures-th">G12/13<br/>SignProp</th>
                <th class="signatures-th">G12/13<br/>Symbol</th>
            </tr>
<!--            <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>-->
        </thead>
        <tbody>
            {% for entry in signatures %}
              {% if entry|length > 1 %}
                <tr>
                    <td data-order="{{ entry.sort }}"><span>{{ entry.position }}</span></td>

                    <!-- Class A data -->
                    <td><span>{{ entry.class_a_aa }}</span></td>
                    <td>{{ entry.class_a_aa_cons }}</td>
                    <td><span>{{ entry.class_a_prop }}</span></td>
                    <td>{{ entry.class_a_prop_cons }}</td>

                    <!-- Positional data -->
                    <td><span>{{ entry.segment }}</span></td>
                    <td><span>{{ entry.membane_segment }}</span></td>
                    <td>{{ entry.membane_placement }}</td>
                    <td><span>{{ entry.residue_orientation }}</span></td>
                    <td><span>{{ entry.microswitch }}</span></td>
                    <td><span>{{ entry.sodium }}</span></td>
                    <td><span>{{ entry.rotamer_switch }}</span></td>

                    <!-- Mutation data -->
                    <td>{{ entry.natural_mutations }}</td>
                    <td>{{ entry.basal_mutations }}</td>
                    <td>{{ entry.ligand_mutations }}</td>
                    <td>{{ entry.phos }}</td>
                    <td>{{ entry.palm }}</td>
                    <td>{{ entry.glyc }}</td>
                    <td>{{ entry.ubiq }}</td>
                    <td>{{ entry.thermo_mutations }}</td>

                    <!-- X-ray data -->
                    <td>{{ entry.ligand_binding }}</td>
                    <td>{{ entry.active_contacts }}</td>
                    <td>{{ entry.inactive_contacts }}</td>
                    <td>{{ entry.intrasegment_contacts }}</td>
                    <td>{{ entry.gprotein_interface }}</td>
                    <td>{{ entry.arrestin_interface }}</td>

                    <!-- Signatures data-->
                    <td>{{ entry.cah_score }}</td>
                    <td>{{ entry.cah_prop }}</td>
                    <td>{{ entry.cah_symb }}</td>
                    <td>{{ entry.cal_score }}</td>
                    <td>{{ entry.cal_prop }}</td>
                    <td>{{ entry.cal_symb }}</td>
                    <td>{{ entry.gs_score }}</td>
                    <td>{{ entry.gs_prop }}</td>
                    <td>{{ entry.gs_symb }}</td>
                    <td>{{ entry.gio_score }}</td>
                    <td>{{ entry.gio_prop }}</td>
                    <td>{{ entry.gio_symb }}</td>
                    <td>{{ entry.gq_score }}</td>
                    <td>{{ entry.gq_prop }}</td>
                    <td>{{ entry.gq_symb }}</td>
                    <td>{{ entry.g12_score }}</td>
                    <td>{{ entry.g12_prop }}</td>
                    <td>{{ entry.g12_symb }}</td>
                </tr>
              {% else %}
<!--                <tr>
                  <td colspan=39><h3><b>{{ entry.position }}</b></h3></td>
                </tr>-->
              {% endif %}
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
